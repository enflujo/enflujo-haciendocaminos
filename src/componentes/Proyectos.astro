---
import proyectos from '../../estaticos/proyectos.json';
---

<div id="listaProyectos">
  <h2>Proyectos</h2>

  <ul>
    {
      proyectos.map((proyecto) => (
        <li id={`proyecto_${proyecto.id}`} class="nodoProyecto" data-id={proyecto.id}>
          {proyecto.nombre.nombre}
        </li>
      ))
    }
  </ul>
</div>

<script>
  import { datosProyectos, datosFicha } from '@/utilidades/cerebro';
  const nodosProyectos = document.querySelectorAll<HTMLLIElement>('.nodoProyecto');
  const conteoFicha = document.getElementById('conteoFicha') as HTMLDivElement;

  datosProyectos.subscribe((datos) => {
    if (!datos.length) return;

    nodosProyectos.forEach((nodoProyecto) => {
      nodoProyecto.onclick = () => {
        const contenedorTitulo = document.getElementById('contenedorTitulo') as HTMLDivElement;
        contenedorTitulo.style.flexBasis = '100%';
        conteoFicha.style.display = 'none';

        const id = nodoProyecto.dataset.id;
        if (!id) return;
        const datosProyecto = datos.find((proyecto) => `${proyecto.id}` === id);

        if (!datosProyecto) return;

        datosFicha.set({
          visible: true,
          lista: 'Proyecto',
          id: datosProyecto.id,
          titulo: datosProyecto.nombre.nombre,
          descripcion: datosProyecto.descripcion ? datosProyecto.descripcion : '',
          paises: datosProyecto.paises ? datosProyecto.paises : [],
          categorias: datosProyecto.categorias ? [datosProyecto.categorias] : [],
          lideres: datosProyecto.lideres ? datosProyecto.lideres : [],
          roles: datosProyecto.roles ? [datosProyecto.roles] : [],
          participantes: datosProyecto.participantes ? datosProyecto.participantes : [],
          ramas: datosProyecto.ramas ? datosProyecto.ramas : [],
          temas: datosProyecto.temas ? datosProyecto.temas : [],
          objetos: datosProyecto.objetos ? datosProyecto.objetos : [],
          municipios: datosProyecto.municipios ? datosProyecto.municipios : [],
          decadas: datosProyecto.decadas ? datosProyecto.decadas : [],
          enlaces: datosProyecto.enlaces ? datosProyecto.enlaces : [],
          imagenes: datosProyecto.imagenes ? datosProyecto.imagenes : []
        });
      };
    });
  });
</script>
